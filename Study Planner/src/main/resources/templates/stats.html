<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Statistiques - Study Planner</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Statistiques</h3>
        <a class="btn btn-secondary" th:href="@{/dashboard}">Dashboard</a>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Derniers 7 jours</div>
                <div class="card-body">
                    <canvas id="daily"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">8 dernières semaines</div>
                <div class="card-body">
                    <canvas id="weekly"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Analyse intelligente</div>
        <div class="card-body">
            <p><strong>Heure la plus active :</strong> <span th:text="${aiReport.mostActiveHour}">0</span>h</p>
            <p><strong>Score de régularité :</strong> <span th:text="${aiReport.consistencyScore}">0</span>/10</p>
            <p><strong>Score de productivité :</strong> <span th:text="${aiReport.productivityScore}">0</span>/10</p>
            <ul>
                <li th:each="suggestion : ${aiReport.suggestions}" th:text="${suggestion}"></li>
            </ul>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const dailyLabels = [[${dailyStats.keySet()}]];
    const dailyValues = [[${dailyStats.values()}]];
    const weeklyLabels = [[${weeklyStats.keySet()}]];
    const weeklyValues = [[${weeklyStats.values()}]];

    new Chart(document.getElementById('daily'), {
        type: 'line',
        data: {
            labels: dailyLabels,
            datasets: [{
                label: 'Minutes',
                borderColor: '#198754',
                data: dailyValues
            }]
        }
    });

    new Chart(document.getElementById('weekly'), {
        type: 'bar',
        data: {
            labels: weeklyLabels,
            datasets: [{
                label: 'Minutes',
                backgroundColor: '#0d6efd',
                data: weeklyValues
            }]
        }
    });
    /*]]>*/
</script>
</body>
</html>

